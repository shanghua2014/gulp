window.DB={config:{url:"https://beta.huanxi.com",server:"qa",pageSize:4,curPage:0,maxPage:0,vtype:0,stype:0,mid:$("#SourceID").val(),flag:1,refreshTime:"",userinfo:{username:"hahaah",signature:"",vipendtime:"",vipstarttime:"",pageSize:50},memberRes:{res:"",index:0,playTime:"",tradeId:""},timer:{a:3e5,b:2e3},getAPI:function(e){var t="";for(var i in window.apis)if(e==apis[i].code)return t=apis[i].url}},isLogin:function(){return"undefined"!=typeof $.cookie("uid")},request:function(e){var t=DB.config.getAPI(e.datas.tul);$.post(t,e.datas,function(t){e.datas.stream_url&&(t.stream_url=e.datas.stream_url),e.element&&(t.element=e.element),Request.show(t,e.fn)})}};var Request=function(){function e(e,i){switch(parseInt(e.code)){case 2e3:t["state"+e.code]&&t["state"+e.code](e,i);break;case 2001:t["state"+e.code]&&t["state"+e.code](e,i);break;case 4017:t["state"+e.code]&&t["state"+e.code](e,i);break;case 4019:t["state"+e.code]&&t["state"+e.code](e,i);break;default:FV.popup(e.message)}}var t={state2000:function(e,t){i[t]&&i[t](e,t)},state2001:function(e,t){a[t]&&a[t](e,t)},state4017:function(e,t){s[t]&&a[t](e,t)},state4019:function(e,t){l[t]&&l[t](e,t)}},i={userOut:function(e){$.cookie("urlval",null,{expires:0,path:"/"}),$.cookie("username",null,{expires:0,path:"/"}),$.cookie("isvip",null,{expires:0,path:"/"}),$.cookie("avatar",null,{expires:0,path:"/"});var t=window.location.href;2==t.split("play_").length?window.location.reload(!0):2==t.split("/user/").length?window.location.href="/login/login.html":($("#userIconA").find("img").remove(),$("#tabNav").find("li:last").remove())},userInfo:function(e){$.cookie("username",e.result.username,{expires:365,path:"/"}),$.cookie("isvip",e.result.isvip,{expires:365,path:"/"}),$.cookie("avatar",e.result.avatar,{expires:365,path:"/"});var t='<img src="'+e.result.avatar+'" />';$("#userIconA").find("a").html(t),DB.config.userinfo.username=e.result.username,DB.config.userinfo.vipendtime=e.result.vipendtime,DB.config.userinfo.vipstarttime=e.result.vipstarttime,"/site/html/pay.shtml"==window.location.href.split("com")[1]&&(this.htm="",this.htm+='<div class="img fl"><img src="'+e.result.avatar+'" width="74" height="76"></div>',this.htm+='<div class="info fl">',this.htm+='<div class="name fl wid">'+e.result.username+"</div>",1==e.result.isvip?this.htm+='<div class="vip vip1 fl wid"><span class="block fl"></span>您已开通会员</div>':this.htm+='<div class="vip fl wid"><span class="block fl"></span>您还未开通会员</div>',this.htm+="</div>",$("#face").html(this.htm))},wxmemberRes:function(e){var t=new Date;t.setTime(t.getTime()+18e4),$.cookie("playTime",1,{expires:t,path:"/"}),clearInterval(DB.config.memberRes.playTime),window.location.href=DB.config.url+"/user/index.shtml#/index"},openMember:function(e){this.htm="";for(var t in e.result){var i=parseInt(t)+1;this.htm+='<li class="li'+i+' fl" title="点击选择" alt="'+e.result[t].codeurl+'">',1==i&&(this.htm+='<span class="sp1">推荐</span>'),this.htm+="<p>"+e.result[t].price+"元/"+e.result[t].name+"</p>",DB.config.memberRes.index==t?(this.htm+='<div class="pay_check pa"><img src="../../img/pay_check.png"  /></div>',DB.config.memberRes.tradeId=e.result[t].codeurl.split("?tradeId=")[1]):this.htm+='<div class="pay_check pa none"><img src="../../img/pay_check.png" /></div>',this.htm+="</li>"}this.htm+="<script>HX.mathMember()</script>",DB.config.memberRes.res=e.result,$("#wx_er_img").html('<img src="'+e.result[DB.config.memberRes.index].codeurl+'" />'),$("#price").html(this.htm),setTimeout(function(){DB.request({datas:{tul:133,platform:1},fn:"openMember"})},DB.config.timer.a),DB.config.memberRes.playTime=setInterval(function(){$.cookie("payTime")||DB.request({datas:{tul:137,tradeId:DB.config.memberRes.tradeId},fn:"wxmemberRes"})},DB.config.timer.b)},playCollect:function(e){e.result?e.result.iscollect&&$("#collectPop").find("span").addClass("active"):$("#collectPop").find("span").addClass("active")},moveSlice:function(e){this.html="";var t=e.result;for(var i in t)this.html+='<a href="javascript:;" style="z-index:'+(9-parseInt(i))+'" class="block pa" alt="'+t[i].stream_url+'"><img src="'+t[i].stills+'"></a>';this.html+='<div class="itemList pa">',this.html+='<ul class="item mar">';for(var i in t)0==i?this.html+='<li class="on"></li>':this.html+="<li></li>";this.html+="</ul>",this.html+="</div>",this.html+="<script>HX.playPlayer($('#moveSlice'),\"a\", 3000, true).moveSlice()</script>",$("#moveSlice").html(this.html)},listPlayMovie:function(e){var t,i,a,s,l=$.cookie("uid"),n=e.element.attr("data-lookurl"),o=e.element.attr("data-streamurl"),m=e.element.attr("data-mid"),r="userid="+l+"&mid="+m+"&look_url="+n+"&stream_url="+o+"&ph_url="+o,c=$(window),h=c.width(),p=c.height(),d=$("#playBox"),u=$("#playMask");s=this._writeflashobject(r,!0,"100%","100%"),u.removeClass("none"),d.removeClass("none").append(s),$("body").css({height:0,overflow:"hidden"}),t=c.scrollTop(),i=h>1201?(h-1200)/2:0,a=p>676?(p-675)/2:0,u.css({width:h,height:p}),c.resize(function(){h=c.width(),p=c.height(),i=h>1201?(h-1200)/2:0,a=p>676?(p-675)/2:0,d.css({left:i,top:a}),h=h>1200?h:1200,p=p>675?p:675,u.css({width:h,height:p}),h>1201&&$("body").css({overflowX:"auto"})}),d.css({left:i,top:a}),$("#playBack").click(function(){$("body").css({height:"100%",overflowY:"auto"}),u.addClass("none").css({width:0,height:0}),d.addClass("none"),$(this).next().remove(),c.scrollTop(t)})},playMovie:function(e){var t=$.cookie("uid"),i=$("#look_url").val(),a=e.stream_url?e.stream_url:$("#stream_url").val(),s=($("#foreshow_url").val(),DB.config.mid),l="userid="+t+"&mid="+s+"&look_url="+i+"&stream_url="+a+"&vtype="+DB.config.vtype+"&ph_url="+a,n="";1==DB.config.vtype?(n=2==DB.config.stype?this._writeflashobject(l,!0,914,494):this._writeflashobject(l,!0),$("#flashMovie").html(n)):1==DB.config.stype?(n=this._writeflashobject(l,!0,914,494),$("#moveSlicePop").find("div").html(n)):(n=this._writeflashobject(l,!0,800,600),$("#moveSlicePop").html(n))},_writeflashobject:function(e,t,i,a){var s=i?i:1200,l=a?a:675;return this.html="",this.html+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=11,0,0,0" width='+s+" height="+l+' id="FlashVars" align="middle"><param name="allowScriptAccess" value="always" /><param name="movie" value="https://player.huanxi.com/main_'+DB.config.server+".swf?"+Math.random()+'" /><param name="FlashVars" value="'+e+'" /><param name="quality" value="high" /><param name="scale" value="noscale" /><param name="allowFullScreen" value="'+t+'"/><param name="bgcolor" value="#000000" /><embed id="players" src="https://player.huanxi.com/main_'+DB.config.server+".swf?"+Math.random()+'" allowFullScreen="'+t+'"  scale="noscale" quality="high" bgcolor="#000000" width="'+s+'" height="'+l+'" name="FlashVars" align="middle" allowScriptAccess="always" FlashVars="'+e+'" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" /></object><script>$("#players").focus()</script>',this.html},commentPublish:function(e){$("#comment_edit").hide(),$("#count").text(70),FV.popup(e.message);var t="",i=new Date,a=i.getFullYear(),s=i.getMonth()+1,l=i.getDate(),n=i.getHours(),o=i.getMinutes(),m=i.getSeconds(),r=a+"-"+s+"-"+l+" "+n+":"+o+":"+m,c='<div class="comment fl"><div class="title pr"> <div class="img_11 fl"><img src="'+DB.config.avatar+'" width="40" height="40"></div> <div class="fl username" title="'+DB.config.username+'">'+DB.config.username+'</div> <span class="vipIcon vipIcon_1 pa"></span></div> <div class="info wid fl">'+$("#pubTArea").val()+'</div> <div class="tim fl wid"><span class="block fl">'+r+'</span> <p class="zan fr"><span class="zanSpan block fl" alt="'+e.result.cid+'"></span><span>0</span></p><input type="hidden" class="uid" value="'+$.cookie("uid")+'"> </div> </div>',h="",p=$("#movieComment").find(".comment").length;h=$("#movieComment").find(".comment").clone(),p||$("#movieComment").html(c),h.each(function(e){p<DB.config.pageSize?t+='<div class="comment fl">'+$(this).html()+"</div>":($(this).hasClass("commentMar")&&$(this).removeClass("commentMar"),t+='<div class="comment fl">'+$(this).html()+"</div>"),$("#movieComment").html(c+t),p<DB.config.pageSize?"":$(".comment:last").remove(),$("#praise").html(HX.playPraise())}),$("#movieComment").find(".comment").each(function(e){e%DB.config.pageSize==0&&$(this).addClass("commentMar")}),$("#moreComment").show(),$("#pubTArea").val(""),console.log(111),$.removeCookie("isComment")},playComment:function(e){if($("#loading").hide(),"0"==e.result.total)return void $("#movieComment").html("暂无数据");DB.config.curPage||FV.timeFormmat2({element:$(".showtimes"),loop:!1}),this.html="";for(var t in e.result.comments){var i=e.result.comments[t];t%DB.config.pageSize==0?this.html+='<div class="comment commentMar fl">':this.html+='<div class="comment fl">',this.html+='<div class="title pr">',this.html+='<div class="img_11 fl"><img src="'+i.useinfo.avatar+'" width="40" height="40"/></div>',this.html+='<div class="fl username" title="'+i.useinfo.username+'">'+i.useinfo.username+"</div>",this.html+='<span class="vipIcon vipIcon_1 pa"></span>',this.html+="</div>",this.html+='<div class="info wid fl">'+i.content+"</div>",this.html+='<div class="tim fl wid">',this.html+='<span class="block fl">'+FV.timeFormat(i.createtime,2)+"</span>",parseInt(i.voted)?this.html+='<p class="zan fr"><span class="zanSpanBind zanSpanA block fl" alt="'+i.id+'"></span><span>'+i.up+"</span></p>":this.html+='<p class="zan fr"><span class="zanSpan block fl" alt="'+i.id+'"></span><span>'+i.up+"</span></p>",this.html+='<input type="hidden" class="uid" value="'+i.useinfo.id+'"/>',this.html+="</div>",this.html+="</div>"}DB.config.curPage?$("#movieComment").append(this.html):(e.result.total<=DB.config.pageSize&&$("#moreComment").hide(),$("#movieComment").html(this.html),DB.config.maxPage=e.result.maxpage),$("#praise").html(HX.playPraise()),DB.config.curPage=e.result.curpage},playPraise:function(e){var t=parseInt(e.element.next().text())+1;e.element.unbind("click").removeClass("zanSpan").addClass("zanSpanBind zanSpanA"),e.element.next().text(t)},feedback:function(e){FV.popup(e.message)}},a={playCollect:function(e){$("#collectPop").find("span").removeClass("active")}},s={},l={userInfo:function(e){$("#log_out").trigger("click"),window.location.href=DB.config.url+"/login/login.html"},listPlayMovie:function(e){i.listPlayMovie(e)},playMovie:function(e){i.playMovie(e)}};return{show:e}}();