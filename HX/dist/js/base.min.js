window.DB={config:{url:"https://www.huanxi.com",username:"",avatar:"",pageSize:4,curPage:0,maxPage:0,vtype:0,mid:$("#SourceID").val(),flag:1,refreshTime:"",getAPI:function(e){var t="";for(var i in window.apis)if(e==apis[i].code)return t=apis[i].url}},isLogin:function(){return"undefined"!=typeof $.cookie("uid")},request:function(e){var t=DB.config.getAPI(e.datas.tul);$.post(t,e.datas,function(t){e.datas.stream_url&&(t.stream_url=e.datas.stream_url),e.element&&(t.element=e.element),Request.show(t,e.fn)})}};var Request=function(){function e(e,i){switch(parseInt(e.code)){case 2e3:t["state"+e.code]&&t["state"+e.code](e,i);break;case 2001:t["state"+e.code]&&t["state"+e.code](e,i);break;case 4019:t["state"+e.code]&&t["state"+e.code](e,i);break;default:FV.popup(e.message)}}var t={state2000:function(e,t){i[t]&&i[t](e,t)},state2001:function(e,t){n[t]&&n[t](e,t)},state4019:function(e,t){a[t]&&a[t](e,t)}},i={userOut:function(e){$.cookie("urlval",null,{expires:0,path:"/"}),$.cookie("vipendtime",null,{expires:0,path:"/"}),$.cookie("username",null,{expires:0,path:"/"}),$.cookie("isvip",null,{expires:0,path:"/"}),2==window.location.href.split("playcontent_").length?window.location.reload(!0):($("#userIconA").find("img").remove(),$("#tabNav").find("li:last").remove())},userInfo:function(e){var t='<img src="'+e.result.avatar+'" />';$("#userIconA").find("a").html(t),DB.config.username=e.result.username,DB.config.avatar=e.result.avatar,$.cookie("username",e.result.username,{expires:365,path:"/"}),$.cookie("isvip",e.result.isvip,{expires:365,path:"/"}),"/site/html/pay.shtml"==window.location.href.split("com")[1]&&(this.htm="",this.htm+='<div class="img fl"><img src="'+e.result.avatar+'" width="74" height="76"></div>',this.htm+='<div class="info fl">',this.htm+='<div class="name fl wid">'+e.result.username+"</div>",1==e.result.isvip?this.htm+='<div class="vip vip1 fl wid"><span class="block fl"></span>您已开通会员</div>':this.htm+='<div class="vip fl wid"><span class="block fl"></span>您还未开通会员</div>',this.htm+="</div>",$("#face").html(this.htm))},wxMember:function(e){$("#wx_er_img").html(""),$("#wx_er_img").qrcode({width:259,height:259,text:e.result.info.qr}),$("#tab_wx").addClass("tab_wx_active"),$("#wx_er").removeClass("none"),DB.config.refreshTime=setInterval(function(){$.cookie("refreshTime")||DB.request({datas:{tul:137},fn:"wxMemberResult",element:this})},1e4)},wxMemberResult:function(e){if(e.result.orstatus){var t=new Date;t.setTime(t.getTime()+18e4),$.cookie("refreshTime",1,{expires:t,path:"/"}),clearInterval(DB.config.refreshTime),window.location.href=DB.config.url+"/user/index.shtml#/index"}},zfbMember:function(e){window.open(e.result.url)},openMember:function(e){this.htm="";for(var t in e.result){var i=parseInt(t)+1;this.htm+='<li class="li'+i+' fl" title="点击选择">',this.htm+="<p>"+e.result[t].price+"元/"+e.result[t].name+"</p>",1==i?this.htm+='<div class="pay_check pa"><img src="../../img/pay_check.png" alt="'+e.result[t].id+'" /></div>':this.htm+='<div class="pay_check pa none"><img src="../../img/pay_check.png" alt="'+e.result[t].id+'" /></div>',this.htm+="</li>"}this.htm+="<script>HX.mathMember()</script>",$("#monthly").val(e.result[0].id),$("#price").html(this.htm),DB.request({datas:{tul:118,type:"vip",id:e.result[0].id},fn:"wxMember"})},playCollect:function(e){e.result?e.result.iscollect&&$("#collectPop").find("span").addClass("active"):$("#collectPop").find("span").addClass("active")},moveSlice:function(e){this.html="";var t=e.result;for(var i in t)this.html+='<a href="javascript:;" style="z-index:'+(9-parseInt(i))+'" class="block pa" alt="'+t[i].stream_url+'"><img src="'+t[i].stills+'"></a>';this.html+='<div class="itemList pa">',this.html+='<ul class="item mar">';for(var i in t)0==i?this.html+='<li class="on"></li>':this.html+="<li></li>";this.html+="</ul>",this.html+="</div>",this.html+="<script>HX.playPlayer($('#moveSlice'),\"a\", 3000, true).moveSlice()</script>",$("#moveSlice").html(this.html)},listPlayMovie:function(e){var t,i,n,a,s=$.cookie("uid"),l=e.element.attr("data-lookurl"),o=e.element.attr("data-streamurl"),r=e.element.attr("data-mid"),c="userid="+s+"&mid="+r+"&look_url="+l+"&stream_url="+o+"&ph_url="+o,m=$(window),u=m.width(),h=m.height(),d=$("#playBox"),p=$("#playMask");a=this._writeflashobject(c,!0,"100%","100%"),p.removeClass("none"),d.removeClass("none").append(a),$("body").css({height:0,overflow:"hidden"}),t=m.scrollTop(),i=u>1201?(u-1200)/2:0,n=h>676?(h-675)/2:0,p.css({width:u,height:h}),m.resize(function(){u=m.width(),h=m.height(),i=u>1201?(u-1200)/2:0,n=h>676?(h-675)/2:0,d.css({left:i,top:n}),u=u>1200?u:1200,h=h>675?h:675,p.css({width:u,height:h}),u>1201&&$("body").css({overflowX:"auto"})}),d.css({left:i,top:n}),$("#playBack").click(function(){$("body").css({height:"100%",overflowY:"auto"}),p.addClass("none").css({width:0,height:0}),d.addClass("none"),$(this).next().remove(),m.scrollTop(t)})},playMovie:function(e){var t=$.cookie("uid"),i=$("#look_url").val(),n=e.stream_url?e.stream_url:$("#stream_url").val(),a=($("#foreshow_url").val(),$("#SourceID").val()),s="userid="+t+"&mid="+a+"&look_url="+i+"&stream_url="+n+"&vtype="+DB.config.vtype+"&ph_url="+n;if(1==DB.config.vtype){var l=this._writeflashobject(s,!0);$("#flashMovie").html(l)}else{var l=this._writeflashobject(s,!0,800,600);$("#moveSlicePop").html(l)}},_writeflashobject:function(e,t,i,n){var a=i?i:1200,s=n?n:675;return this.html="",this.html+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=11,0,0,0" width='+a+" height="+s+' id="FlashVars" align="middle"><param name="allowScriptAccess" value="always" /><param name="movie" value="https://player.huanxi.com/main_www.swf?'+Math.random()+'" /><param name="FlashVars" value="'+e+'" /><param name="quality" value="high" /><param name="scale" value="noscale" /><param name="allowFullScreen" value="'+t+'"/><param name="bgcolor" value="#000000" /><embed id="players" src="https://player.huanxi.com/main_www.swf?'+Math.random()+'" allowFullScreen="'+t+'"  scale="noscale" quality="high" bgcolor="#000000" width="'+a+'" height="'+s+'" name="FlashVars" align="middle" allowScriptAccess="always" FlashVars="'+e+'" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" /></object><script>$("#players").focus()</script>',this.html},commentPublish:function(e){$("#comment_edit").hide(),$("#count").text(70),FV.popup(e.message);var t="",i=new Date,n=i.getFullYear(),a=i.getMonth()+1,s=i.getDate(),l=i.getHours(),o=i.getMinutes(),r=i.getSeconds(),c=n+"-"+a+"-"+s+" "+l+":"+o+":"+r,m='<div class="comment fl"><div class="title pr"> <div class="img_11 fl"><img src="'+DB.config.avatar+'" width="40" height="40"></div> <div class="fl username" title="'+DB.config.username+'">'+DB.config.username+'</div> <span class="vipIcon vipIcon_1 pa"></span></div> <div class="info wid fl">'+$("#pubTArea").val()+'</div> <div class="tim fl wid"><span class="block fl">'+c+'</span> <p class="zan fr"><span class="zanSpan block fl" alt="'+e.result.cid+'"></span><span>0</span></p><input type="hidden" class="uid" value="'+$.cookie("uid")+'"> </div> </div>',u="",h=$("#movieComment").find(".comment").length;u=$("#movieComment").find(".comment").clone(),h||$("#movieComment").html(m),u.each(function(e){h<DB.config.pageSize?t+='<div class="comment fl">'+$(this).html()+"</div>":($(this).hasClass("commentMar")&&$(this).removeClass("commentMar"),t+='<div class="comment fl">'+$(this).html()+"</div>"),$("#movieComment").html(m+t),h<DB.config.pageSize?"":$(".comment:last").remove(),$("#praise").html(HX.playPraise())}),$("#movieComment").find(".comment").each(function(e){e%DB.config.pageSize==0&&$(this).addClass("commentMar")}),$("#moreComment").show(),$("#pubTArea").val("")},playComment:function(e){if($("#loading").hide(),"0"==e.result.total)return void $("#movieComment").html("暂无数据");DB.config.curPage||FV.timeFormmat2({element:$(".showtimes"),loop:!1}),this.html="";for(var t in e.result.comments){var i=e.result.comments[t];t%DB.config.pageSize==0?this.html+='<div class="comment commentMar fl">':this.html+='<div class="comment fl">',this.html+='<div class="title pr">',this.html+='<div class="img_11 fl"><img src="'+i.useinfo.avatar+'" width="40" height="40"/></div>',this.html+='<div class="fl username" title="'+i.useinfo.username+'">'+i.useinfo.username+"</div>",this.html+='<span class="vipIcon vipIcon_1 pa"></span>',this.html+="</div>",this.html+='<div class="info wid fl">'+i.content+"</div>",this.html+='<div class="tim fl wid">',this.html+='<span class="block fl">'+FV.timeFormat(i.createtime,2)+"</span>",parseInt(i.voted)?this.html+='<p class="zan fr"><span class="zanSpanBind zanSpanA block fl" alt="'+i.id+'"></span><span>'+i.up+"</span></p>":this.html+='<p class="zan fr"><span class="zanSpan block fl" alt="'+i.id+'"></span><span>'+i.up+"</span></p>",this.html+='<input type="hidden" class="uid" value="'+i.useinfo.id+'"/>',this.html+="</div>",this.html+="</div>"}DB.config.curPage?$("#movieComment").append(this.html):(e.result.total<=DB.config.pageSize&&$("#moreComment").hide(),$("#movieComment").html(this.html),DB.config.maxPage=e.result.maxpage),$("#praise").html(HX.playPraise()),DB.config.curPage=e.result.curpage},playPraise:function(e){var t=parseInt(e.element.next().text())+1;e.element.unbind("click").removeClass("zanSpan").addClass("zanSpanBind zanSpanA"),e.element.next().text(t)},feedback:function(e){$("#form")[0].reset(),FV.popup(e.message)}},n={playCollect:function(e){$("#collectPop").find("span").removeClass("active")}},a={userInfo:function(e){$("#log_out").trigger("click"),window.location.href=DB.config.url+"/login/login.html"},listPlayMovie:function(e){i.listPlayMovie(e)},playMovie:function(e){i.playMovie(e)}};return{show:e}}(),HXCTRL=function(){if(this instanceof HXCTRL){var e=function(){l($("#mobileLook"),$("#mobile_look"))},t=function(e){l($("#collectPop"),$("#collect_pop"),e)},i=function(){l($("#comment"),$("#comment_edit"))},n=function(){l($("#movieInfo"),$("#movie_info"))},a=function(){l($("#sharePop"),$("#share_pop"))},s=function(e){e.siblings().find(".pop").slideUp(),$(".close").click(function(){return $(this).parent().slideUp("fast"),!1})},l=function(e,i,n){return n=!!n&&n,"collect"!=n?void e.click(function(){return d(),"collectPop"==$(this).attr("id")&&t("collect"),"comment"==$(this).attr("id"),s(e),i.slideDown(),!1}):void DB.request({datas:{tul:107,mid:DB.config.mid,vtype:1},fn:"playCollect"})},o=function(){var e=DB.config.url+"/newhtml/wap/index.shtml#/"+encodeURI("mid="+$("#SourceID").val());$("#erCode").qrcode({width:160,height:160,text:e})},r=function(){$("#moreComment").click(function(){$("#loading").fadeIn();var e=DB.config.curPage+1;e==DB.config.maxPage&&$(this).remove(),DB.request({datas:{tul:300,mid:DB.config.mid,page:e,size:DB.config.pageSize},fn:"playComment"})})},c=0,m=function(e,t,i,n){var a=0,s=0;a=u(e,t,i,n,s),e.mouseenter(function(){return n&&h(e,t),clearInterval(a.t),clearInterval(a.t),!1}),e.mouseleave(function(){return a=u(e,t,i,n,a.i),!1})},u=function(e,t,i,n,a){var s={i:0,t:0},l=e.find(t),o=l.length,r=$(".item").find("li").length;return 1==r&&$(".item").remove(),h(e,t),s.t=setInterval(function(){n&&(a=c),a++,a>=o-1&&(a=-1),n&&(c=a,$(".item").find("li").eq(a).addClass("on").siblings().removeClass("on")),l.eq(a).fadeIn().siblings(t).fadeOut(),s.i=a},i),s},h=function(e,t){$(".item").find("li").each(function(){$(this).click(function(){c=$(this).index(),$(this).addClass("on").siblings().removeClass("on"),e.find(t).eq(c).fadeIn().siblings(t).fadeOut(),e.find(t).eq(c).fadeIn().siblings(t).fadeOut()})})},d=function(){return!!DB.isLogin()||($.cookie("urlval",window.location.href,{expires:7,secure:!0,path:"/"}),window.location.href=DB.config.url+"/login/login.html",!1)},p=function(){var e=navigator.userAgent.toLowerCase(),t="ipad"==e.match(/ipad/i),i="iphone os"==e.match(/iphone os/i),n="midp"==e.match(/midp/i),a="rv:1.2.3.4"==e.match(/rv:1.2.3.4/i),s="ucweb"==e.match(/ucweb/i),l="android"==e.match(/android/i),o="windows ce"==e.match(/windows ce/i),r="windows mobile"==e.match(/windows mobile/i);return!!(t||i||n||a||s||l||o||r)};return{indexJump:function(){var e=window.location.href.split(DB.config.url);return"/"==e[1]&&$.cookie("uid")?window.location.href=DB.config.url+"/player.shtml":$("#logo").click(function(){return!0}),this},userOut:function(){return $("#log_out").click(function(){return DB.request?DB.request({datas:{tul:101},fn:"userOut"}):$.post(DB.getAPI(101),"",function(e){$.cookie("urlval",null,{expires:0,path:"/"}),$.cookie("vipendtime",null,{expires:0,path:"/"}),window.location.href=DB.url+"/login/login.html"}),!1}),this},userInfo:function(){var e=$.cookie("uid");e?DB.request({datas:{tul:106},fn:"userInfo"}):$("#tabNav").find("li:last-child").remove(),$("#userIconA").find("a").click(function(){if(e){if(p())return;window.location.href="/user/index.shtml"}else $.cookie("urlval",window.location.href,{expires:7,secure:!0,path:"/"}),window.location.href=DB.config.url+"/login/login.html";return!1});var t=window.location.href;return t.indexOf("player.shtml")>-1?$(".searchTerm").find("li").eq(0).find("a").addClass("active"):t.indexOf("classic")>-1?$(".searchTerm").find("li").eq(1).find("a").addClass("active"):t.indexOf("chat.shtml")>-1&&$(".searchTerm").find("li").eq(2).find("a").addClass("active"),this},mathMember:function(){$("#price").find("li").each(function(){$(this).click(function(){$(this).find("div").removeClass("none"),$(this).siblings().find("div").addClass("none");var e=$(this).find(".pay_check").find("img").attr("alt");$("#monthly").val(e),$("#wx_er_img").html("二维码加载中，请稍等！"),DB.request({datas:{tul:118,type:"vip",id:e},fn:"wxMember"})})}),$("#tab_wx, #tab_zfb").click(function(){var e=$("#monthly").val();if(""==e)return void FV.popup("请选择套餐");if("tab_zfb"==$(this).attr("id")){var t=navigator.userAgent;if(t.indexOf("Safari")>-1){var i=window.open("","_blank");$.post("https://www.huanxi.com/pay/pay/alipay",{type:"vip",id:e},function(e){function t(){i.location=e.result.url}2e3==e.code&&setTimeout(t(),800)})}else DB.request({datas:{tul:117,type:"vip",id:e},fn:"zfbMember"})}})},openMember:function(){$.cookie("uid")?DB.request({datas:{tul:133},fn:"openMember"}):window.location.href=DB.config.url+"/login/login.html"},listPlay:function(){return $(".play_btn_a").each(function(){$(this).click(function(){var e=$(this).attr("data-mid");DB.request({datas:{tul:110,mid:e},fn:"listPlayMovie",element:$(this)})})}),this},play:function(){return e(),i(),n(),t(!1),a(),o(),$("#commentPublish").click(function(){var e=$.cookie("isComment");if(!e){var t=$("#pubTArea").val();if(""==t)return void FV.popup("请输入评论内容");if(t.length>70)return void FV.popup("您输入的字数过多!");if(FV.JSTextFilter(t))return void FV.popup("内容中包含敏感字符，请重新输入!");$.cookie("isComment",1),DB.request({datas:{tul:112,mid:DB.config.mid,content:t,replyid:0},fn:"commentPublish"})}}),$("#playBtn").click(function(){$(this).unbind("click"),DB.config.vtype=1,DB.request({datas:{tul:110,mid:DB.config.mid},fn:"playMovie"})}),DB.request({datas:{tul:134,mid:DB.config.mid},fn:"moveSlice"}),DB.request({datas:{tul:300,mid:DB.config.mid,page:1,size:DB.config.pageSize},fn:"playComment"}),DB.request({datas:{tul:139,mid:DB.config.mid},fn:"playCollect"}),r(),this},winning:function(){var e=$("#awards").html();if(e){var t=e.split("\n"),i="",n=0;for(var a in t)t[a]&&(n++,i+="<dd><p>"+t[a].split("|_|")[0]+'</p><p class="pad_t15">'+t[a].split("|_|")[1]+"</p></dd>");$("#winning").removeClass("none"),n<4&&$("#winningDl").css({width:300*n}),$("#winningDl").html(i)}return this},playerList:function(){var e="",t="",i=$("#playerlistData").val();if(i){for(var n=i.split("==="),a=0;a<n.length;a++)"导演"==n[a].split("|")[1]?(e+='<div class="swiper-slide">',e+='<a href="'+n[a].split("|")[3]+'" target="_blank" class="block fl"><img src="'+n[a].split("|")[2]+'" width="180" height="208" class="fl"></a>',e+="<p>"+n[a].split("|")[0]+"</p>",e+="<span>"+n[a].split("|")[1]+"</span>",e+="</div>"):(t+='<div class="swiper-slide">',t+='<a href="'+n[a].split("|")[3]+'" target="_blank" class="block fl"><img src="'+n[a].split("|")[2]+'" width="180" height="208" class="fl"></a>',t+="<p>"+n[a].split("|")[0]+"</p>",t+="<span>"+n[a].split("|")[1]+"</span>",t+="</div>");$("#swiper-wrapper").html(e+t),i.split("===").length>6&&($(".swiper-slide").css({marginLeft:0}),$(".swiper-button-prev").removeClass("none"),$(".swiper-button-next").removeClass("none"),new Swiper(".swiper-container",{pagination:".swiper-pagination",slidesPerView:6,spaceBetween:10,loop:!1,prevButton:".swiper-button-prev",nextButton:".swiper-button-next"}))}return this},moveSlice:function(){return $("#moveSlice").find("a").each(function(e){$(this).click(function(){DB.config.vtype=3;var e=$(this).attr("alt");$("#moveSlicePop").removeClass("none").html("加载中,请稍后..."),$("#moveSliceMask").removeClass("none").html("<script>HX.moveSliceClose()</script>"),$("#moveSlicePopBack").removeClass("none"),DB.request({datas:{tul:110,mid:DB.config.mid,stream_url:e},fn:"playMovie"})})}),this},playCollect:function(){return t(!1),this},playPlayer:function(e,t,i,n){return m(e,t,i,n),this},moveSliceClose:function(){$("#moveSlicePopBack").click(function(){$("#moveSlicePop").addClass("none").html("加载中,请稍后..."),$("#moveSliceMask").addClass("none"),$(this).addClass("none")})},playPraise:function(){$(".zanSpan").each(function(){$(this).click(function(){d();var e=$(this).attr("alt");return DB.request({datas:{tul:302,cid:e},fn:"playPraise",element:$(this)}),!1})})},fontLimite:function(e){var t=$("#pubTArea");return t.keyup(function(){var i=e;t.val().length>i&&t.val(t.val().substring(0,i));var n=i-t.val().length;$("#count").text(n.toString())}),this},secondToHour:function(e,t){return e.each(function(){var e=t?$(this).find(t).find("span"):$(this).find("span"),i=parseInt(e.text()/60);e.text(i),t?$(this).find(t).removeClass("none"):$(this).find("span").removeClass("none")}),this},timeFormat:function(e,t){return e.each(function(){var e=$(this).text();$(this).text(FV.timeFormat(e,t)),$(this).removeClass("none")}),this},feedback:function(){return $("#form").submit(function(){var e=$("#phone").val(),t=$("#idea").val();return e&&t||FV.popup("请填写所有内容！"),FV.JSTextFilter(e)||FV.JSTextFilter(t)?FV.popup("内容中包含敏感字符，请重新输入！"):DB.request({datas:{tul:138,num:e,idea:t},fn:"feedback"}),!1}),this}}}return new HXCTRL},HX=HXCTRL();